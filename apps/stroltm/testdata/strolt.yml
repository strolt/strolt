name: stroltm

timezone: UTC

api:
  users:
    admin: admin

tags:
  - tag_from_root_config

services:
  e2e:
    pg-t:
      tags:
        - tag_from_task_config
      source:
        driver: pg
        config:
          host: postgres
          database: strolt
          username: strolt
          password: strolt #pragma: allowlist secret
          format: t
      destinations:
        restic-pg-t:
          extends: restic_base
          env:
            RESTIC_REPOSITORY: "s3:http://minio:9000/e2e/restic-pg-t"
  e2e2:
    pg-t:
      source:
        driver: pg
        config:
          host: postgres
          database: strolt
          username: strolt
          password: strolt #pragma: allowlist secret
          format: t
      destinations:
        restic-pg-t:
          extends: restic_base
          env:
            RESTIC_REPOSITORY: "s3:http://minio:9000/e2e2/restic-pg-t"
    pg-t2:
      source:
        driver: pg
        config:
          host: postgres
          database: strolt
          username: strolt
          password: strolt #pragma: allowlist secret
          format: t
      destinations:
        restic-pg-t:
          extends: restic_base
          env:
            RESTIC_REPOSITORY: "s3:http://minio:9000/e2e2/restic-pg-t2"

definitions:
  destinations:
    restic_base:
      driver: restic
      config:
        keep:
          last: 3
      env:
        RESTIC_PASSWORD: strolt #pragma: allowlist secret
        RESTIC_REPOSITORY: s3:http://minio:9000/restic-pg-t
        AWS_ACCESS_KEY_ID: minioadmin
        AWS_SECRET_ACCESS_KEY: minioadmin #pragma: allowlist secret
